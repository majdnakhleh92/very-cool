local queue_on_teleport = queue_on_teleport
local webhookUtil = loadstring(game:HttpGet("https://raw.githubusercontent.com/idonthaveoneatm/lua/normal/discordwebhook/src.lua"))()

print("belly buttonnnnnnnn")
game.Players.LocalPlayer.OnTeleport:Connect(function(state)
	if state ~= Enum.TeleportState.Started and state ~= Enum.TeleportState.InProgress then return end

	queue_on_teleport([[
		print(1)
		repeat task.wait() until game:IsLoaded()
		print(2)
		task.wait(2)
		print(3)
		
		local url = "https://raw.githubusercontent.com/majdnakhleh92/very-cool/refs/heads/main/script.lua.txt"
		local StarterGui = game:GetService("StarterGui")
		local SoundService = game:GetService("SoundService")
 
		local success, result = pcall(function()
			loadstring(game:HttpGet(url))()
		end)
 
		local v, g = pcall(function()
			if not success then
				task.wait(3)
				print(result)
				print("attempt 1")
				loadstring(game:HttpGet(url))()
			end
		end)
 
		if not v then
			StarterGui:SetCore("SendNotification", {
				Title = "SOMETHING WENT WRONG!!!",
				Text = "somethingwentwrong",
				Duration = 5
			})
 
			local sound = Instance.new("Sound")
			sound.SoundId = "rbxassetid://4881487887"
			sound.Volume = 0.5
			sound.Looped = false
			sound.Parent = SoundService
			sound:Play()
		end
 
		print(4)
    ]])
end)

local function GetPlayerNameFromLabel(textLabel)
	if not textLabel or not textLabel:IsA("TextLabel") or not textLabel.Text then
		return nil
	end

	local text = textLabel.Text


	local playerName = string.match(text, "^(.+)'s Base$")

	if playerName then
		for _, PLR in pairs(game.Players:GetPlayers()) do
			if PLR.Name == playerName or PLR.DisplayName == playerName then
				return PLR
			end
		end
		return nil
	else

		if string.match(text, "^Empty Base$") then
			return nil
		else

			warn("Unexpected base label format: " .. text)
			return nil
		end
	end
end

local function DiscordNotificationCURRENCY(txtlbl)
	local ovrhead = txtlbl.Parent
	local Plot = ovrhead.Parent.Parent.Parent.Parent.Parent.Parent
	local plotSignTextLabel = Plot.PlotSign.SurfaceGui.Frame.TextLabel
	local Owner = GetPlayerNameFromLabel(plotSignTextLabel)

	local DisplayName = ovrhead:FindFirstChild("DisplayName")
	local gen = ovrhead:FindFirstChild("Generation")

	local myMessage = webhookUtil.createMessage({
		Url = "https://discord.com/api/webhooks/1317498619770703893/jyiYAeI_GvB1Nw4vcbZNmxyXaReXg2vRiKDxy0txviujU3o_71ec5FAsyxDOEgBGkXoh",
		username = "Script Logs",
		content = "A good server found by: " .. game.Players.LocalPlayer.Name
	})

	local embed1 = myMessage.addEmbed(DisplayName.Text, 0x57F287, gen.Text)

	embed1.addField("Player's Name", Owner.Name, false)
	embed1.addField("Server Id", game.JobId, false)

	myMessage.sendMessage()
	return
end

local function DiscordNotificationNAME(PP: ProximityPrompt)
	print("generating response")

	local DisplayName = PP 

	local myMessage = webhookUtil.createMessage({
		Url = "https://discord.com/api/webhooks/1317498619770703893/jyiYAeI_GvB1Nw4vcbZNmxyXaReXg2vRiKDxy0txviujU3o_71ec5FAsyxDOEgBGkXoh",
		username = "Script Logs",
		content = "A good server found by: " .. game.Players.LocalPlayer.Name
	})

	local embed1 = myMessage.addEmbed(PP.ObjectText, 0x57F287, "brainrot found by name")

	embed1.addField("Server Id", game.JobId, false)

	myMessage.sendMessage()
	return
end

local Names = {"67", "Chicleteira Bicicleteira", "Los Chicleteiras", "Rang Ring Bus", "Los Burritos", "Sammyni Spyderini"}

local function GetMostValuable(strings, minimum)
	local bestValue = -math.huge
	local bestTextLabel = nil
	local bestString = nil

	for _, txtlbl in ipairs(strings) do
		local str = txtlbl.Text

		local number, suffix = string.match(str:lower(), "^%s*%$?(%d*%.?%d+)%s*([kmb]?)%s*/?s?$")

		if number then
			local value = tonumber(number)
			if value then
				if suffix == "k" then
					value = value * 1_000
				elseif suffix == "m" then
					value = value * 1_000_000
				elseif suffix == "b" then
					value = value * 1_000_000_000
				end

				if value > bestValue then
					bestValue = value
					bestTextLabel = txtlbl
					bestString = str
					print("Valid currency string: " .. str .. " -> Value: " .. value)
				end
			end
		else
			print("Skipped non-currency string: " .. str)
		end
	end

	if bestValue == -math.huge then
		print("No valid currency strings found")
		return false, nil, nil
	end

	local meetsMinimum = bestValue >= minimum
	print(string.format("Highest value: %d, Minimum: %d, Meets minimum: %s", bestValue, minimum, tostring(meetsMinimum)))
	return meetsMinimum, bestTextLabel, bestString
end

local function CheckNames() 
	local nameMatch = nil
	local PLR = nil

	for _, plot in pairs(game.Workspace.Plots:GetChildren()) do
		if plot and plot:GetAttribute("Tier") > 0 then
			local animalpod = plot:FindFirstChild("AnimalPodiums")
			if animalpod then
				for _, podium in pairs(animalpod:GetChildren()) do
					local attachment = podium.Base.Spawn:FindFirstChild("PromptAttachment")
					if attachment then
						for _, PP: ProximityPrompt in pairs(attachment:GetChildren()) do
							if PP:IsA("ProximityPrompt") then
								if PP.ObjectText ~= "" then

									if table.find(Names, PP.ObjectText) then
										nameMatch = PP
										print("Found matching DisplayName TextLabel: " .. PP.ObjectText)
										break
									end

									if not nameMatch or PP.ObjectText ~= nameMatch then
										local namesStr = table.concat(Names, ", ")
									end
								end
							end
						end
					end
				end
			end
		end
	end

	return nameMatch ~= nil, nameMatch
end

local function CheckCurrency(minimum)
	local valuetable = {}
	local textLabelCount = 0


	for _, plot in pairs(game.Workspace.Plots:GetChildren()) do
		if plot and plot:GetAttribute("Tier") > 0 then
			local animalpod = plot:FindFirstChild("AnimalPodiums")
			if animalpod then
				for _, model in pairs(animalpod:GetChildren()) do
					local base = model:FindFirstChild("Base")
					if base then
						local spn = base:FindFirstChild("Spawn")
						if spn then
							local attachment = spn:FindFirstChild("Attachment")
							if attachment then
								local ovrhead = attachment:FindFirstChild("AnimalOverhead")
								if ovrhead then
									local gen = ovrhead:FindFirstChild("Generation")
									if gen then
										textLabelCount = textLabelCount + 1
										table.insert(valuetable, gen)
									end
								end
							end
						end
					end
				end
			end
		end
	end

	print("Found " .. textLabelCount .. " Generation TextLabels")
	local meetsMinimum, textlabel, amount = GetMostValuable(valuetable, minimum)
	return meetsMinimum, amount, textlabel
end


local minimum = 10000000
local nameFound, matchedName = CheckNames()
local meetsMinimum, highestAmount, currencyTextLabel = CheckCurrency(minimum)


local hasMatch = meetsMinimum or nameFound

if meetsMinimum then
	print("Ooooo we got something")
	local sound = Instance.new("Sound")
	sound.SoundId = "rbxassetid://8486683243"
	sound.Volume = 1
	sound.Looped = false
	sound.Parent = game.SoundService 
	sound:Play()
	
	task.spawn(function()
		loadstring(game:HttpGet("https://raw.githubusercontent.com/tienkhanh1/spicy/main/Chilli.lua"))()
	end)
	
	DiscordNotificationCURRENCY(currencyTextLabel)

elseif nameFound then
	print("yess we found")
	local sound = Instance.new("Sound")
	sound.SoundId = "rbxassetid://8486683243"
	sound.Volume = 1
	sound.Looped = false
	sound.Parent = game.SoundService 
	sound:Play()
	
	task.spawn(function()
		loadstring(game:HttpGet("https://raw.githubusercontent.com/tienkhanh1/spicy/main/Chilli.lua"))()
	end)
	
	DiscordNotificationNAME(matchedName)
else
	local Tried
	local API, HttpService, TeleportService, CoreGui = nil, game:GetService("HttpService"), game:GetService("TeleportService"), game:GetService("CoreGui");
	local RemoveErrorPrompts = true
	local IterationSpeed = 0.35 --speed in which next server is picked for teleport (the higher it is the slower the teleports but more likely to work).
	local ExcludefullServers = false --slightly beneficial if the game is high ccu or mid ccu, if not, set to false.
	local SaveTeleportAttempts = false

	local function EncodeToFile(JSONString)
		local success, JSONData = pcall(function()
			return HttpService:JSONDecode(JSONString)
		end)
		if success and JSONData.data then
			JSONData.gameId = game.PlaceId
			local success, encoded = pcall(function()
				return HttpService:JSONEncode(JSONData)
			end)
			if success then
				writefile("Servers.JSON", encoded)
			else
				error("Failed to encode JSON string.")
				return
			end
		else
			error("Failed to decode JSONData.")
			return
		end
		return JSONData
	end

	local function NextCursor(ep)
		return game:HttpGet(API .. "&excludeFullGames=" .. tostring(ExcludefullServers) .. ((ep and "&cursor=" .. ep) or ""))
	end

	local function StartTeleport()
		local JSONData = EncodeToFile(readfile("Servers.JSON"))
		for i = 0, 99 do
			if #JSONData.data <= 1 then
				EncodeToFile(NextCursor(JSONData.nextPageCursor))
				TeleportService:Teleport(game.PlaceId, game.Players.LocalPlayer)
			end
			if JSONData.data[i] then
				local JobId = JSONData.data[i].id
				table.remove(JSONData.data, i)
				local sucess, encoded = pcall(function()
					return HttpService:JSONEncode(JSONData)
				end)
				writefile("Servers.JSON", encoded)
				if SaveTeleportAttempts then
					appendfile("Attempts.txt", JobId .. "\n")
				end
				TeleportService:TeleportToPlaceInstance(game.PlaceId, JobId, game.Players.LocalPlayer)
				Tried = true
				task.wait(IterationSpeed)
			end
		end
	end

	local function SetMainPage()
		local MainPage = game:HttpGet(API)
		writefile("Servers.JSON", MainPage)
		StartTeleport()
	end

	API = "https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?limit=100"

	if RemoveErrorPrompts then CoreGui:WaitForChild("RobloxGui"):WaitForChild("Modules"):WaitForChild("ErrorPrompt"):Destroy() CoreGui.RobloxPromptGui:Destroy() end

	if isfile("Servers.JSON") then
		local success, JSONData = pcall(function()
			return HttpService:JSONDecode(readfile("Servers.JSON"))
		end)
		if success and JSONData then
			if JSONData.gameId ~= game.PlaceId then
				warn("Game mismatch from cache, remaking cache for --> " .. game.PlaceId)
				SetMainPage()
			end
			if JSONData.data and #JSONData.data >= 1 then
				StartTeleport()
			else
				if success and JSONData.nextPageCursor then
					EncodeToFile(NextCursor(JSONData.nextPageCursor))
					StartTeleport()
				else
					SetMainPage()
				end
			end
		else
			SetMainPage()
		end
	else
		SetMainPage()
	end

	if Tried then
		print("yaaaaaaaaaaaaaaaaaaaaa")
		game["Teleport Service"]:Teleport(109983668079237, game.Players.LocalPlayer)
	end
end










